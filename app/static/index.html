<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Recorder</title>
    <script defer src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script defer src="app.js"></script>
</head>
<body>
    <h1>Video Recorder</h1>
    <div style="margin-bottom: 15px; color: #666;">
        <p>Using camera device: <strong>/dev/video2</strong></p>
    </div>
    <div>
        <label>Split Duration (seconds):</label>
        <input type="number" id="splitDuration" value="90" readonly />
    </div>
    <button onclick="startRecording()">Start Recording</button>
    <button onclick="stopRecording()">Stop Recording</button>
    <div id="recordingStatus" style="margin-top: 10px;">
        <span id="recordingTime" style="color: red; display: none;">Recording Time: 00:00:00</span>
    </div>
    <p id="errorMessage" style="color: red"></p>
    <h2>Recorded Videos</h2>
    <ul id="videoList"></ul>
</body>
</html>

<script>
let recordingTimer;
let startTime;

async function startRecording() {
    try {
        await axios.get(`/start?split_duration=90`);
        document.getElementById("errorMessage").innerText = "";
        startTime = new Date();
        document.getElementById("recordingTime").style.display = "block";
        recordingTimer = setInterval(updateRecordingTime, 1000);
    } catch (error) {
        document.getElementById("errorMessage").innerText = error.response?.data?.error || "An unknown error occurred";
    }
}

async function stopRecording() {
    try {
        await axios.get('/stop');
        document.getElementById("errorMessage").innerText = "";
        clearInterval(recordingTimer);
        document.getElementById("recordingTime").style.display = "none";
        await fetchVideos();
    } catch (error) {
        document.getElementById("errorMessage").innerText = error.response?.data?.error || "An unknown error occurred";
    }
}

function updateRecordingTime() {
    const now = new Date();
    const diff = now - startTime;
    const hours = Math.floor(diff / 3600000);
    const minutes = Math.floor((diff % 3600000) / 60000);
    const seconds = Math.floor((diff % 60000) / 1000);
    const timeString = `Recording Time: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    document.getElementById("recordingTime").innerText = timeString;
}

async function fetchVideos() {
    try {
        const response = await axios.get('/list');
        const videoList = document.getElementById("videoList");
        videoList.innerHTML = '';
        response.data.videos.forEach(video => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = `/download/${video}`;
            a.textContent = video;
            li.appendChild(a);
            videoList.appendChild(li);
        });
    } catch (error) {
        document.getElementById("errorMessage").innerText = error.response?.data?.error || "Error fetching videos";
    }
}

// Initial video list fetch
fetchVideos();
</script>
